{% extends 'auctions/layout.html' %}

{% block body %}

    <h3>Listing: {{ listing.title }} </h3>
    <!-- Watchlist -->
    {% if user.is_authenticated %}
        <form action="{% url 'watchlist' listing_id=listing.id %}" method="post">
            {% csrf_token %}
            {% if not listing in user.watchlist.all %}
                <input type="hidden" name="form_id" value="form1">
                <button type="submit">Add to Watchlist</button>
            {% else %}
                <input type="hidden" name="form_id" value="form2">
                <button type="submit">Remove from Watchlist</button>
            {% endif %}
        </form>
    {% endif %}
    <p> {{ listing.description }} </p>

    <div>&#36; {{ listing.bid }} </div>

    {% if message %}
        <b>{{ message }}</b>
    {% endif %}

    {% if user.is_authenticated and not user == listing.user  %}

        <form action="{% url 'bid' listing_id=listing.id %}" method="post">
            {% csrf_token %}
            {{ bid_form.as_p }}
            <button type="submit">Place Bid</button>
        </form>

    {% elif user.is_authenticated and user == listing.user %}
        
        <form action="{% url 'close' listing_id=listing.id %}" method="post">
            {% csrf_token %}
            <input type="submit" value="Close the Auction">
        </form>    

    {% endif %}

    <h4>Details</h4>
    <ul>
        <li>Listed By: {{ listing.user }}</li>
        <li>Category: {{ listing.category }}</li>
    </ul>

{% endblock %}